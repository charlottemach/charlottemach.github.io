<!doctype html>
<!--

 This page was compiled by ðŸ“œ Scroll, a public domain
 programming language and static site publishing tool.
 
 https://scroll.pub
 
 Generally you don't want to edit it by hand.

 Scroll v31.4.1

-->
<html lang="en-US">
 <head>
  <meta charset="utf-8"></meta>
  <title>Tracing with Jaeger on EKS with Istio - Cookies & Containers</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"></meta>
  <meta name="description" content="Or how I learned to love the cloud."></meta>
  <meta name="generator" content="Scroll v31.4.1"></meta>
  <meta property="og:title" content="Tracing with Jaeger on EKS with Istio"></meta>
  <meta property="og:description" content="April 13, 2022 â€” Understanding and debugging microservices communication can be a challenge in itself. Luckily there are a bunch of tools to make it easier."></meta>
  <meta property="og:image" content="https://charlottemach.com/assets/images/jaeger1.png Traces"></meta>
  <link rel="alternate" type="application/rss+xml" title="Cookies & Containers" href="feed.xml"></link>
  <meta name="twitter:card" content="summary_large_image"></meta>
  <link rel="stylesheet" type="text/css" href="scrollStyle.css"></link>
</head>
 <body>
  <div class="scrollHeaderComponent">
   <div class="scrollTopRightBarComponent">
    <div class="scrollSocialMediaIconsComponent">
     <a href="https://github.com/charlottemach/"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub icon</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
</div>
</div>
   <h2 class="scrollNameComponent">
    <a href="index.html">Cookies & Containers</a>
</h2>
   <div>Or how I learned to love the cloud.</div>
</div>
  <h1 class="scrollFilePageTitle">
   <a href="2022-04-13-jaeger-eks.html">Tracing with Jaeger on EKS with Istio</a>
</h1>
  <div class="scrollFilePageComponent" style=""><h1 class="scrollTitleComponent"><a href="2022-04-13-jaeger-eks.html">Tracing with Jaeger on EKS with Istio</a></h1>




















<div class="scrollKeyboardNav"><a href="2022-09-03-scroll.html">2022-09-03-scroll.html</a> Â· 2022-04-13-jaeger-eks.html Â· <a href="2022-01-06-trying-litmus.html">2022-01-06-trying-litmus.html</a><script>document.addEventListener('keydown', function(event) {
  if (document.activeElement !== document.body) return
  const getLinks = () => document.getElementsByClassName("scrollKeyboardNav")[0].getElementsByTagName("a")
  if (event.key === "ArrowLeft")
    getLinks()[0].click()
  else if (event.key === "ArrowRight")
    getLinks()[1].click()
 });</script></div>

<p class="scrollParagraphComponent"><span class="scrollDateComponent">April 13, 2022 â€” </span>Understanding and debugging microservices communication can be a challenge in itself. Luckily there are a bunch of tools to make it easier.</p>
In addition to the observability you get from running visualization tooling like Kiali with your service mesh, tracing provides valuable information for troubleshooting. That's where [Jaeger](https://github.com/jaegertracing/jaeger) comes in.


<h3 class="scrollSectionComponent">Installing Jaeger </h3>
Jaeger provides an [Operator](https://github.com/jaegertracing/jaeger-operator#getting-started), and a Helm chart to get started.
Using the Helm chart, installation is simple:
<code class="scrollCodeBlockComponent">$ helm repo add jaegertracing https://jaegertracing.github.io/helm-charts</code>
to use custom settings add your own `values.yaml` file (e.g. an existing ElasticSearch cluster as a datastore in this case)
<code class="scrollCodeBlockComponent">storage:
  type: elasticsearch
  elasticsearch:
    host: elasticsearch.elk.svc.cluster.local  # using a local elasticsearch
    port: 9200
    # user: &lt;USER>
    # password: &lt;PASSWORD>
provisionDataStore:
  cassandra: false                             # disabling the default cassandra
  elasticsearch: false                         # disabling creating a ES cluster
collector:
  service:
    zipkin:                                    
      port: 9411                               # opening the port for istio to push</code>
<p class="scrollParagraphComponent">Install jaeger with</p>
<code class="scrollCodeBlockComponent">$ helm install jaeger jaegertracing/jaeger --values values.yaml --namespace istio-system</code>
<p class="scrollParagraphComponent">Resulting in something like this</p>
<code class="scrollCodeBlockComponent">NAME: jaeger
LAST DEPLOYED: Mon Apr 11 18:36:34 2022
NAMESPACE: istio-system
STATUS: deployed
REVISION: 1
TEST SUITE: None
NOTES:
###################################################################
### IMPORTANT: Ensure that storage is explicitly configured     ###
### Default storage options are subject to change.              ###
###                                                             ###
### IMPORTANT: The use of &lt;component>.env: {...} is deprecated. ###
### Please use &lt;component>.extraEnv: [] instead.                ###
###################################################################

You can log into the Jaeger Query UI here:

  export POD_NAME=$(kubectl get pods --namespace istio-system -l "app.kubernetes.io/instance=jaeger,app.kubernetes.io/component=query" -o jsonpath="{.items[0].metadata.name}")
  echo http://127.0.0.1:8080/
  kubectl port-forward --namespace istio-system $POD_NAME 8080:16686</code>
<p class="scrollParagraphComponent">giving you the commands you need to locally check out the UI.</p>


<h3 class="scrollSectionComponent">Adapting Istio</h3>
<p class="scrollParagraphComponent">To see actual traces, you'll need to edit Istio to forward data to Jaeger.
Edit the istio ConfigMap in istio-system to point tracer.zipkin.address to </p>
<code class="scrollCodeBlockComponent">jaeger-collector.istio-system.svc.cluster.local:9411</code>
<p class="scrollParagraphComponent">You need to restart the istiod pod for the change to take effect.</p>

<h3 class="scrollSectionComponent">Architecture</h3>

<p class="scrollParagraphComponent">The traffic data goes from each istio-proxy sidecar to agents (running as DaemonSets on each host), to the collector, which validates, indexes and transforms the traces and either stores them or forwards them to Kafka. 
The default setup "samples" 1% of transactions/traces.</p>

The github page has a great [architecture diagram here](https://github.com/jaegertracing/documentation/blob/7f1f07f182302cde97ee33db4f48958b831e7dda/static/img/architecture-v1.png).

<h3 class="scrollSectionComponent">Usage</h3>
After sending a few hundred requests to your application (or [bookinfo](https://istio.io/latest/docs/examples/bookinfo/) as a standin), you can see the traces in the UI.
<figure class="scrollImageComponent"><a href="assets/images/jaeger1.png" target="_blank"><img src="assets/images/jaeger1.png" width="3012" height="1464" loading="lazy"/></a></figure>

The System Architecture view won't show anything, unless you're using the all-in-one setup.
For seeing the entire distributed architecture you can use Kiali or add [Jaeger analytics](https://github.com/jaegertracing/jaeger-analytics) to fill in the blank page.

<p class="scrollFileViewSourceUrlComponent"><a href="https://github.com/charlottemach/charlottemach.github.io/blob/main/2022-04-13-jaeger-eks.scroll">View source</a></p></div>
  <div class="scrollFooterComponent">
   <div class="scrollSocialMediaIconsComponent">
    <a href="mailto:charlotte.mach@fs.lmu.de"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Gmail icon</title><path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L5.455 4.64 12 9.548l6.545-4.91 1.528-1.145C21.69 2.28 24 3.434 24 5.457z"/></svg></a>
    <a href="https://twitter.com/tinydata42"><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>Twitter icon</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg></a>
    <a href="https://github.com/charlottemach/"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub icon</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
</div>
   <a href="https://scroll.pub" class="scrollCommunityLinkComponent">Built with Scroll v31.4.1</a>
</div>
</body>
</html>
