<!doctype html>
<!--

 This page was compiled by ðŸ“œ Scroll, a public domain
 programming language and static site publishing tool.
 
 https://scroll.pub
 
 Generally you don't want to edit it by hand.

 Scroll v31.4.1

-->
<html lang="en-US">
 <head>
  <meta charset="utf-8"></meta>
  <title>Adventures in Telco I: Setting up a Kubernetes Deployment using XOS - Cookies & Containers</title>
  <meta name="viewport" content="width=device-width,initial-scale=1"></meta>
  <meta name="description" content="Or how I learned to love the cloud."></meta>
  <meta name="generator" content="Scroll v31.4.1"></meta>
  <meta property="og:title" content="Adventures in Telco I: Setting up a Kubernetes Deployment using XOS"></meta>
  <meta property="og:description" content="June 25, 2020 â€” This blog post describes how you can deploy a few Kubernetes resources onto an edge computing platform, so that those resources can be managed via XOS."></meta>
  <meta property="og:image" content="https://charlottemach.com/assets/images/xos-diagram.png "Deployment Workflow""></meta>
  <link rel="alternate" type="application/rss+xml" title="Cookies & Containers" href="feed.xml"></link>
  <meta name="twitter:card" content="summary_large_image"></meta>
  <link rel="stylesheet" type="text/css" href="scrollStyle.css"></link>
</head>
 <body>
  <div class="scrollHeaderComponent">
   <div class="scrollTopRightBarComponent">
    <div class="scrollSocialMediaIconsComponent">
     <a href="https://github.com/charlottemach/"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub icon</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
</div>
</div>
   <h2 class="scrollNameComponent">
    <a href="index.html">Cookies & Containers</a>
</h2>
   <div>Or how I learned to love the cloud.</div>
</div>
  <h1 class="scrollFilePageTitle">
   <a href="2020-06-25-adventures-telco-xos.html">Adventures in Telco I: Setting up a Kubernetes Deployment using XOS</a>
</h1>
  <div class="scrollFilePageComponent" style=""><h1 class="scrollTitleComponent"><a href="2020-06-25-adventures-telco-xos.html">Adventures in Telco I: Setting up a Kubernetes Deployment using XOS</a></h1>


<p class="scrollParagraphComponent"><span class="scrollDateComponent">June 25, 2020 â€” </span>This blog post describes how you can deploy a few Kubernetes resources onto an edge computing platform, so that those resources can be managed via XOS.</p>

<h3 class="scrollSectionComponent">What is XOS?</h3>

<p class="scrollParagraphComponent">The <a href="https://www.opennetworking.org/cord/">CORD platform</a> gives network operators a cloud-native and open-source reference implementation of a Mobile Edge Computing stack.</p>













<div class="scrollKeyboardNav"><a href="2020-08-31-simple-k8s-operator-java.html">2020-08-31-simple-k8s-operator-java.html</a> Â· 2020-06-25-adventures-telco-xos.html Â· <a href="2020-06-12-byo-prometheus.html">2020-06-12-byo-prometheus.html</a><script>document.addEventListener('keydown', function(event) {
  if (document.activeElement !== document.body) return
  const getLinks = () => document.getElementsByClassName("scrollKeyboardNav")[0].getElementsByTagName("a")
  if (event.key === "ArrowLeft")
    getLinks()[0].click()
  else if (event.key === "ArrowRight")
    getLinks()[1].click()
 });</script></div>


<p class="scrollParagraphComponent">It mostly consists of </p>
<ul class="scrollUnorderedListComponent">
<li>XOS, the extensible service control plane responsible for service management </li>
<li>ONOS the SDN controller, taking care of the infrastructure devices and links, while managing the network (from paths to flow rules)</li>
<li>VOLTHA (optional), virtual OLT hardware abstraction, broadband as a service, PON network management</li>
<li>Kafka, for event processing between the different components </li>
<li>Logging and monitoring tools </li>
</ul>
<p class="scrollParagraphComponent">all of which are containerized and running on Kubernetes.</p>

<p class="scrollParagraphComponent">XOS is helping you generate the control plane by allowing you to define your own service models that are then synchronized to either Kubernetes, OpenStack or other environments.</p>

<p class="scrollParagraphComponent">Usually you'd have to write a model (detailing attributes and components of future resources) as well as a synchronizer (detailing what steps to take for which model), for example for custom services.</p>

<p class="scrollParagraphComponent">Luckily there is already a <a href=https://guide.opencord.org/master/kubernetes-service/kubernetes-service.html>base-kubernetes</a> service, that allows you to wrap your Kubernetes resources.</p>

<h3 class="scrollSectionComponent">How to deploy CORD</h3>

<figure class="scrollImageComponent"><a href="assets/images/xos-diagram.png" target="_blank"><img src="assets/images/xos-diagram.png" width="2287" height="1465" loading="lazy"/></a></figure>

<h4 class="scrollSubsectionComponent">Step 0</h4>
<p class="scrollParagraphComponent">Starting with the initial step in the diagram above, we want a CORD installation that includes XOS. The simplest and fastest way of doing that is installing <a href=https://guide.opencord.org/profiles/comac/install/ciab.html>COMAC-in-a-box</a> by running</p>
<code class="scrollCodeBlockComponent">git clone https://gerrit.opencord.org/automation-tools
cd automation-tools/comac-in-a-box
make
make test</code>
<p class="scrollParagraphComponent">That installs everything for you, including the Kubernetes cluster CORD is running on.</p>

<h4 class="scrollSubsectionComponent">Step 1</h4>
<p class="scrollParagraphComponent">This is also covered as the script sets up a base-kubernetes, registering the Kubernetes service model with XOS and deploying the Kubernetes synchronizer (see default namespace).</p>

<h3 class="scrollSectionComponent">How to talk to the synchronizer</h3>

<h4 class="scrollSubsectionComponent">Step 2</h4>
<p class="scrollParagraphComponent">This part requires us to write a TOSCA YAML file to wrap the Kubernetes resources.</p>
<p class="scrollParagraphComponent">tosca.yaml:</p>
<code class="scrollCodeBlockComponent">tosca_definitions_version: tosca_simple_yaml_1_0

description: Make a STK image via yaml

imports:
  - custom_types/kubernetesservice.yaml
  - custom_types/kubernetesresourceinstance.yaml

topology_template:
  node_templates:
    service#kubernetes:
      type: tosca.nodes.KubernetesService
      properties:
        name: kubernetes
        must-exist: true

    app_resource_one:
      type: tosca.nodes.KubernetesResourceInstance
      properties:
        name: "app-resource-one"
        resource_definition: |
        &lt;insert Kubernetes YAML>
      requirements:
        - owner:
            node: service#kubernetes
            relationship: tosca.relationships.BelongsToOne

    ...
    app_resource_n:
      type: tosca.nodes.KubernetesResourceInstance
      properties:
        name: "app-resouce-n"
        resource_definition: |
        &lt;insert Kubernetes YAML>
      requirements:
        - owner:
            node: service#kubernetes
            relationship: tosca.relationships.BelongsToOne</code>

<p class="scrollParagraphComponent">This YAML file can now be sent to the TOSCA Pod (which is a part of the XOS service) via a POST request. The username and password are configured for CORD, defaults and how to configure them can be found <a href=https://guide.opencord.org/operating_cord/gui.html>here</a>.</p>

<code class="scrollCodeBlockComponent">curl -H "xos-username: $USERNAME" -H "xos-password: $PASSWORD" -X POST --data-binary @tosca.yaml http://$( hostname ):30007/run</code>

<h4 class="scrollSubsectionComponent">Step 3</h4>
<p class="scrollParagraphComponent">That creates both instances in XOS (see in the XOS GUI at port 30001) and in Kubernetes (see <code>kubectl get pods -A</code>). For deleting those instances repeat the curl with a <code>/delete</code> instead of <code>/run</code>.</p>

<h4 class="scrollSubsectionComponent">Notes</h4>
<p class="scrollParagraphComponent">There are other options of creating a custom XOS service, or using the other options for creating Kubernetes resources e.g. using KubernetesSecret or KubernetesSecretVolumeMount to avoid using KubernetesResourceInstance for everything, but at the time of this post very few resources are covered by this (Pods, secrets, configmaps, NodePort services).</p>
<p class="scrollFileViewSourceUrlComponent"><a href="https://github.com/charlottemach/charlottemach.github.io/blob/main/2020-06-25-adventures-telco-xos.scroll">View source</a></p></div>
  <div class="scrollFooterComponent">
   <div class="scrollSocialMediaIconsComponent">
    <a href="mailto:charlotte.mach@fs.lmu.de"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>Gmail icon</title><path d="M24 5.457v13.909c0 .904-.732 1.636-1.636 1.636h-3.819V11.73L12 16.64l-6.545-4.91v9.273H1.636A1.636 1.636 0 0 1 0 19.366V5.457c0-2.023 2.309-3.178 3.927-1.964L5.455 4.64 12 9.548l6.545-4.91 1.528-1.145C21.69 2.28 24 3.434 24 5.457z"/></svg></a>
    <a href="https://twitter.com/tinydata42"><svg role="img" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><title>Twitter icon</title><path d="M23.953 4.57a10 10 0 01-2.825.775 4.958 4.958 0 002.163-2.723c-.951.555-2.005.959-3.127 1.184a4.92 4.92 0 00-8.384 4.482C7.69 8.095 4.067 6.13 1.64 3.162a4.822 4.822 0 00-.666 2.475c0 1.71.87 3.213 2.188 4.096a4.904 4.904 0 01-2.228-.616v.06a4.923 4.923 0 003.946 4.827 4.996 4.996 0 01-2.212.085 4.936 4.936 0 004.604 3.417 9.867 9.867 0 01-6.102 2.105c-.39 0-.779-.023-1.17-.067a13.995 13.995 0 007.557 2.209c9.053 0 13.998-7.496 13.998-13.985 0-.21 0-.42-.015-.63A9.935 9.935 0 0024 4.59z"/></svg></a>
    <a href="https://github.com/charlottemach/"><svg role="img" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><title>GitHub icon</title><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg></a>
</div>
   <a href="https://scroll.pub" class="scrollCommunityLinkComponent">Built with Scroll v31.4.1</a>
</div>
</body>
</html>
